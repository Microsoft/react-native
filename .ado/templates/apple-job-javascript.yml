parameters:
  apply_office_patches: ''

steps:
  - script: 'brew bundle'
    displayName: 'brew bundle'

  - script: brew link node@10 --overwrite --force
    displayName: 'ensure node 10'

  - template: apple-xcode-select.yml

  - ${{ if eq(parameters.apply_office_patches, 'true') }}:
    - task: CmdLine@2
      displayName: Apply Android specific patches for Office consumption
      inputs:
        script: android-patches\scripts\patch.bat

  - script: 'yarn install'
    displayName: 'yarn install'

  - script: 'yarn test-ci'
    displayName: 'yarn test-ci'

  - script: 'yarn flow-check-ios'
    displayName: 'yarn flow-check-ios'

  - script: 'yarn flow-check-macos'
    displayName: 'yarn flow-check-macos'

  - script: 'yarn flow-check-android'
    displayName: 'yarn flow-check-android'

  - script: 'yarn lint'
    displayName: 'yarn lint'

  - script: 'yarn format-check'
    displayName: 'yarn format-check'